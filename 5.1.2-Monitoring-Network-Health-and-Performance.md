# Monitoring Network Health and Performance

Use the procedures described in this section to configure network health and performance monitoring.


Monitor your network health and performance and take proactive, corrective action where required. 

Azure offers monitoring tools that help detect, analyze and resolve critical network related errors, breaches and issues that conventional network monitoring methods aren't able to detect. 

### Network performance monitoring tools:

  - [Network Performance Monitor](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor-performance-monitor): Monitor network performance between various points of your network infrastructure. 

  - [Service Endpoint Monitor](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor-service-endpoint): You can monitor the connectivity from your users to the services you care about, determine what infrastructure is in the path, and identify where network bottlenecks occur. 
	
  - [ExpressRoute Monitor](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor-expressroute): You can monitor end-to-end connectivity and performance between your on-premises network and Azure, over Azure ExpressRoute. 
	
	
### Azure analytics tools:

  - [Azure Application Gateway Analytics](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-azure-networking-analytics#azure-application-gateway-analytics-solution-in-log-analytics): Collect diagnostics logs directly from Azure Application Gateways.
	
  - [Azure Network Security Analytics](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-azure-networking-analytics#azure-network-security-group-analytics-solution-in-log-analytics): Collect diagnostics logs directly from your Network Security Groups.



## Guidance

Use the following supplemental information:

- When creating monitoring rules, disable the default rule and create custom monitoring rules. This is especially appropriate on large networks that use a large number of nodes for monitoring. Custom monitoring rules can reduce the traffic generated by the solution and help organize the monitoring of the network.
	
- When configuring Network Performance Monitor, create a network that groups subnets. Use this grouping method instead of the default setting (creates the default network and all of the subnets in your environment).
	
- When choosing a protocol, use TCP for monitoring. Use ICMP in scenarios where you can't use TCP, such as: 

     - You use Windows client-based nodes, because TCP raw sockets aren't allowed in Windows clients
     - Your network firewall or NSG blocks TCP
     - You don't know how to switch the protocol
	

## Preparation: Network performance monitor

Perform the following steps prior to using the procedure in this section:

  1. [Identify the supported region](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor#supported-regions)
	
  2. Identify the VMs in the subscription where you wish to install the OMS agents on and [enable Azure Log Analytics](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-add-solutions) in the subscription
	
  3. [Choose the protocol](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor-performance-monitor#choose-the-protocol) you wish to use for synthetic transactions in the Default performance monitoring rule (I.e. TCP, ICMP)


## Preparation:  Azure Application Gateway Analytics

Perform the following steps prior to using the procedure in this section:

  1. Ensure that you have [enabled Azure Log Analytics](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-add-solutions) in the subscription and have a workspace created.
	
  2. Enable the Azure Application Gateway analytics solution from [Azure marketplace](https://azuremarketplace.microsoft.com/en-us/marketplace/apps/microsoft.azureappgatewayanalyticsoms?tab=overview) or by using the process described in [Add Log Analytics solutions](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-add-solutions) from the Solutions Gallery.
	
  3. Enable diagnostics logging for the [Application Gateways](https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-diagnostics) you want to monitor.



## Preparation: Network Security Group

Perform the following steps prior to using the procedure in this section:

  1. Ensure that you have [enabled Azure Log Analytics](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-add-solutions) in the subscription and have a workspace created.
	
  2. Enable the Azure Network Security Group analytics solution from [Azure marketplace](https://azuremarketplace.microsoft.com/en-us/marketplace/apps/microsoft.azureappgatewayanalyticsoms?tab=overview) or by using the process described in [Add Log Analytics solutions](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-add-solutions) from the Solutions Gallery.
	
  3. Enable diagnostics logging for the [Network Security Group](https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-nsg-manage-log) resources you want to monitor.


## Procedure:  How to configure network monitoring 

  1. [How to Configure Network Performance Monitor](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor-performance-monitor#configuration)  
     Open the [Network Performance Monitor](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor) solution, and select Configure.
	
  2. [How to Configure Service Endpoint Monitor](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor-service-endpoint)
     Monitor network connectivity to any endpoint that has an open TCP port. Such endpoints include websites, SaaS applications, PaaS applications, and SQL databases. 
	
  3. [How to Configure ExpressRoute Monitor](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor-expressroute#configuration) 
     Monitor end-to-end connectivity and performance between your branch offices and Azure, over Azure ExpressRoute.
	
  4. [Configure diagnostics to be sent directly to Log Analytics from Azure Application Gateways](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-azure-networking-analytics#enable-azure-application-gateway-diagnostics-in-the-portal)
     Azure Application Gateway analytics solution supports:
     **Logs:** 
	- ApplicationGatewayAccessLog
	- ApplicationGatewayPerformanceLog
	- ApplicationGatewayFirewallLog
     **Metrics**: 5 minute throughput

  5. [Configure diagnostics to be sent directly to Log Analytics from Azure Network Security Groups](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-azure-networking-analytics#enable-azure-network-security-group-diagnostics-in-the-portal)  
     Use the Azure portal to navigate to the Network Security Group resource to configure monitoring.



## Next steps

[Monitoring Network Infrastructure Operations](5.1.3-Monitoring-Network-Infrastructure-Operations.md)


